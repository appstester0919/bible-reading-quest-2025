# 聖經讀經之旅 - PWA 離線功能說明

## 🚀 已實現的 PWA 功能

### ✅ 跨平台支援
- **macOS**: Safari、Chrome、Firefox
- **iOS**: Safari (可添加到主屏幕)
- **Android**: Chrome、Firefox、Edge (可安裝為應用)
- **Windows**: Chrome、Edge、Firefox

### ✅ 離線功能
1. **離線讀經進度記錄**
   - 沒有網路時仍可標記讀經完成
   - 資料儲存在本地 IndexedDB
   - 網路恢復時自動同步到雲端

2. **離線瀏覽**
   - 快取重要頁面和資源
   - 離線時顯示專用離線頁面
   - 保持基本功能可用

3. **背景同步**
   - 使用 Service Worker 背景同步
   - 自動處理網路恢復後的資料同步
   - 防止資料遺失

### ✅ 應用安裝
- 瀏覽器會自動提示安裝到設備
- 安裝後像原生應用一樣運行
- 支援全屏模式和啟動畫面

## 📱 如何安裝到設備

### iOS (iPhone/iPad)
1. 用 Safari 開啟網站
2. 點擊分享按鈕 📤
3. 選擇「加入主畫面」
4. 確認安裝

### Android
1. 用 Chrome 開啟網站
2. 點擊右上角選單 ⋮
3. 選擇「安裝應用程式」或「加入主畫面」
4. 確認安裝

### Windows/macOS
1. 用 Chrome 或 Edge 開啟網站
2. 網址列會出現安裝圖示 ⬇️
3. 點擊安裝
4. 確認安裝

## 🔧 技術實現

### Service Worker
- 檔案位置: `/public/sw.js`
- 功能: 快取管理、離線支援、背景同步

### PWA Manifest
- 檔案位置: `/public/manifest.json`
- 功能: 應用資訊、圖標、顯示模式

### 離線資料管理
- IndexedDB: 本地資料儲存
- 同步管理器: 處理線上/離線資料同步
- 樂觀更新: 立即更新 UI，後台同步資料

### 圖標生成
1. 開啟 `/public/icons/generate-icons.html`
2. 下載生成的圖標
3. 放置在 `/public/icons/` 目錄

## 🌐 離線功能測試

### 測試步驟
1. 正常使用應用並記錄讀經進度
2. 關閉網路連線（飛行模式或斷開 WiFi）
3. 繼續使用應用，標記讀經進度
4. 重新連接網路
5. 檢查資料是否自動同步

### 預期行為
- 離線時顯示離線狀態指示器
- 離線操作正常運作
- 網路恢復時自動同步
- 不會遺失任何資料

## 🔍 故障排除

### 如果 Service Worker 沒有註冊
1. 檢查瀏覽器控制台是否有錯誤
2. 確認 `/public/sw.js` 檔案存在
3. 檢查 HTTPS 連線（本地開發除外）

### 如果離線功能不工作
1. 檢查 IndexedDB 是否被瀏覽器阻擋
2. 清除瀏覽器快取和資料
3. 重新註冊 Service Worker

### 如果安裝提示不出現
1. 確認網站符合 PWA 安裝條件
2. 檢查 manifest.json 是否正確載入
3. 確認圖標檔案存在

## 📊 效能優化

### 快取策略
- 核心檔案: 預先快取
- API 資料: 網路優先，快取備用
- 靜態資源: 快取優先

### 資料同步
- 批次同步: 減少網路請求
- 重試機制: 處理同步失敗
- 衝突解決: 以伺服器資料為準

## 🚀 未來功能

### 計劃中的功能
- [ ] 推播通知提醒
- [ ] 更多離線內容快取
- [ ] 離線聖經文本下載
- [ ] 更智能的同步策略

### 可能的改進
- [ ] 更好的離線 UI 指示
- [ ] 資料壓縮和優化
- [ ] 更細緻的快取控制
- [ ] 離線分析和統計